<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Muz D√ºnyasƒ± üçå</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
  body {
    margin: 0;
    background: black;
    font-family: 'Press Start 2P', monospace;
    overflow: hidden;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
  }
  canvas {
    display: block;
    margin: auto;
    background: #111;
    image-rendering: pixelated;
  }
  #overlay {
    position: fixed;
    top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.8);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 24px;
    visibility: hidden;
  }
  #overlay.show {
    visibility: visible;
  }
  button {
    margin-top: 20px;
    padding: 12px 24px;
    font-family: 'Press Start 2P', monospace;
    font-size: 16px;
    cursor: pointer;
    border: none;
    background: yellowgreen;
    color: black;
    border-radius: 8px;
  }
</style>
</head>
<body>

<canvas id="game" width="400" height="600"></canvas>

<div id="overlay">
  <div id="endingText"></div>
  <button id="restartBtn">TEKRAR OYNA</button>
</div>

<!-- Sesler -->
<audio id="eatSound" src="https://actions.google.com/sounds/v1/foley/munching.ogg" preload="auto"></audio>
<audio id="fartSound" src="https://www.soundjay.com/human/fart-01.mp3" preload="auto"></audio>

<script>
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const overlay = document.getElementById('overlay');
  const endingText = document.getElementById('endingText');
  const restartBtn = document.getElementById('restartBtn');
  const eatSound = document.getElementById('eatSound');
  const fartSound = document.getElementById('fartSound');

  const WIDTH = canvas.width;
  const HEIGHT = canvas.height;

  // Oyunun durumlarƒ±
  let state = 'start'; // start, goodEnd, badEnd

  // Karakter piksel detaylarƒ±
  const character = {
    x: WIDTH/2 - 20,
    y: HEIGHT/2 + 50,
    width: 40,
    height: 70,
  };

  // Muz yeme ve osuruk animasyonu saya√ßlarƒ±
  let eatFrame = 0;
  let fartFrame = 0;
  let fartVisible = false;

  // Muz yaƒüdƒ±rmak i√ßin dizi (k√∂t√º son)
  class Banana {
    constructor(x, y) {
      this.x = x;
      this.y = y;
      this.speed = 2 + Math.random()*2;
    }
    update() { this.y += this.speed; }
    draw(ctx) {
      // Muz sarƒ±sƒ±
      ctx.fillStyle = 'yellow';
      ctx.fillRect(this.x, this.y, 8, 16);
      // Muz sapƒ± kahverengi
      ctx.fillStyle = '#8B4513';
      ctx.fillRect(this.x + 2, this.y + 2, 4, 5);
    }
  }
  let bananas = [];

  // ƒ∞yi sondaki piksel gezegen √ßizimi (uzaydan d√ºnya)
  function drawPixelPlanet(cx, cy, radius) {
    for(let y=-radius; y<=radius; y++) {
      for(let x=-radius; x<=radius; x++) {
        if(x*x + y*y <= radius*radius) {
          let dist = Math.sqrt(x*x + y*y);
          let color = dist > radius*0.7 ? '#003366' : '#009900'; // deniz ve kara renkleri
          ctx.fillStyle = color;
          ctx.fillRect(cx + x*4, cy + y*4, 4, 4);
        }
      }
    }
  }

  // K√∂t√º sondaki muzdan yapƒ±lmƒ±≈ü d√ºnya √ßizimi (basit)
  function drawBananaWorld() {
    const radius = 60;
    const cx = WIDTH/2;
    const cy = HEIGHT/2;
    for(let y=-radius; y<=radius; y++) {
      for(let x=-radius; x<=radius; x++) {
        if(x*x + y*y <= radius*radius) {
          ctx.fillStyle = (x + y) % 2 === 0 ? 'yellow' : '#FFEE55';
          ctx.fillRect(cx + x*3, cy + y*3, 3, 3);
        }
      }
    }
  }

  // Karakter √ßizimi piksel tarzda
  function drawCharacter() {
    // Sa√ß (sarƒ±)
    ctx.fillStyle = '#FFD700';
    ctx.fillRect(character.x + 10, character.y, 20, 15);

    // Y√ºz
    ctx.fillStyle = '#FFE0BD';
    ctx.fillRect(character.x + 10, character.y + 15, 20, 20);

    // G√∂zler (siyah)
    ctx.fillStyle = 'black';
    ctx.fillRect(character.x + 15, character.y + 22, 4, 4);
    ctx.fillRect(character.x + 25, character.y + 22, 4, 4);

    // G√∂mlek (siyah)
    ctx.fillStyle = 'black';
    ctx.fillRect(character.x + 5, character.y + 35, 30, 25);

    // Pantolon (kahverengi)
    ctx.fillStyle = '#8B4513';
    ctx.fillRect(character.x + 5, character.y + 60, 30, 25);

    // Ayakkabƒ± (koyu kahverengi)
    ctx.fillStyle = '#654321';
    ctx.fillRect(character.x + 5, character.y + 85, 12, 10);
    ctx.fillRect(character.x + 23, character.y + 85, 12, 10);

    // Muz (adamƒ±n elinde)
    if(state === 'start' && eatFrame < 30) {
      ctx.fillStyle = 'yellow';
      ctx.fillRect(character.x + 25, character.y + 50, 10, 20);
      ctx.fillStyle = '#8B4513';
      ctx.fillRect(character.x + 27, character.y + 52, 6, 5);
    }
  }

  // Osuruk animasyonu (pƒ±rt)
  function drawFart() {
    if(fartVisible) {
      ctx.fillStyle = 'yellow';
      ctx.beginPath();
      ctx.ellipse(character.x + 20, character.y + character.height + 10, 15, 10, Math.sin(fartFrame/5)*0.2, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = 'white';
      ctx.font = '16px "Press Start 2P"';
      ctx.fillText('Pƒ±rt!', character.x - 20, character.y + character.height + 40);
    }
  }

  // Muz yaƒüdƒ±r (k√∂t√º son)
  function spawnBananas() {
    if(bananas.length < 50) {
      bananas.push(new Banana(Math.random()*WIDTH, -20));
    }
  }

  function updateBananas() {
    bananas.forEach((b, i) => {
      b.update();
      if(b.y > HEIGHT) bananas.splice(i, 1);
    });
  }

  // √áizim fonksiyonu
  function draw() {
    ctx.clearRect(0, 0, WIDTH, HEIGHT);

    if(state === 'start') {
      // G√∂ky√ºz√º ve √ßimen zemin
      ctx.fillStyle = '#87CEEB'; // a√ßƒ±k mavi g√∂ky√ºz√º
      ctx.fillRect(0, 0, WIDTH, HEIGHT);
      ctx.fillStyle = '#228B22'; // √ßimen
      ctx.fillRect(0, character.y + character.height, WIDTH, HEIGHT - (character.y + character.height));

      // G√ºne≈ü
      ctx.fillStyle = 'yellow';
      ctx.fillRect(WIDTH - 80, 30, 50, 50);

      drawCharacter();

      if(eatFrame > 0) {
        ctx.fillStyle = 'black';
        ctx.font = '16px "Press Start 2P"';
        ctx.fillText('Muz yiyor...', 40, 100);
      }

      drawFart();
    }
    else if(state === 'goodEnd') {
      // Uzay arka plan
      ctx.fillStyle = 'black';
      ctx.fillRect(0, 0, WIDTH, HEIGHT);

      // Piksel d√ºnya
      drawPixelPlanet(WIDTH/2, HEIGHT/2, 30);

      // Yazƒ±
      ctx.fillStyle = 'white';
      ctx.font = '28px "Press Start 2P"';
      ctx.fillText('ƒ∞Yƒ∞ SON', WIDTH/2 - 70, HEIGHT/2 + 100);
    }
    else if(state === 'badEnd') {
      // Gece arka plan
      ctx.fillStyle = '#000022';
      ctx.fillRect(0, 0, WIDTH, HEIGHT);

      // Muzdan yapƒ±lmƒ±≈ü d√ºnya
      drawBananaWorld();

      // Muzlar yaƒüsƒ±n
      drawBananas();

      // Yazƒ±
      ctx.fillStyle = 'white';
      ctx.font = '28px "Press Start 2P"';
      ctx.fillText('K√ñT√ú SON', WIDTH/2 - 90, HEIGHT/2 + 100);
    }
  }

  // G√ºncelleme fonksiyonu
  function update() {
    if(state === 'start') {
      if(eatFrame > 0) eatFrame--;

      if(eatFrame === 0 && fartFrame === 0 && fartVisible === false) {
        // Yeme bitti, osuruk animasyon ba≈ülasƒ±n
        if(lastClickedCharacter) {
          fartSound.play();
          fartVisible = true;
          fartFrame = 60;
        }
      }

      if(fartFrame > 0) {
        fartFrame--;
        if(fartFrame === 0) {
          fartVisible = false;
        }
      }
    }
    else if(state === 'badEnd') {
      spawnBananas();
      updateBananas();
    }
  }

  let lastClickedCharacter = false;

  // Ana d√∂ng√º
  function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
  }
  loop();

  // Tƒ±klama eventi
  canvas.addEventListener('click', e => {
    if(state === 'start') {
      const rect = canvas.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const clickY = e.clientY - rect.top;

      // Eƒüer adamƒ±n √ºst√ºne tƒ±klandƒ±ysa (iyi son)
      if(clickX >= character.x && clickX <= character.x + character.width &&
         clickY >= character.y && clickY <= character.y + character.height) {

        if(eatFrame === 0 && fartFrame === 0) {
          eatFrame = 60; // 1 saniye muz yeme animasyonu
          eatSound.play();
          lastClickedCharacter = true;

          // 1.2 saniye sonra osuruk ba≈ülasƒ±n ve 2 saniye sonra iyi sona ge√ßilsin
          setTimeout(() => {
            fartSound.play();
            fartVisible = true;
            fartFrame = 60;

            setTimeout(() => {
              state = 'goodEnd';
              overlay.classList.add('show');
              endingText.textContent = 'ƒ∞Yƒ∞ SON';
            }, 2000);

          }, 1200);
        }

      }
      else {
        // Yere tƒ±klandƒ± ‚Üí k√∂t√º son
        state = 'badEnd';
        bananas = [];
        overlay.classList.add('show');
        endingText.textContent = 'K√ñT√ú SON';
      }
    }
  });

  // Tekrar oyna
  restartBtn.addEventListener('click', () => {
    state = 'start';
    bananas = [];
    eatFrame = 0;
    fartFrame = 0;
    fartVisible = false;
    lastClickedCharacter = false;
    overlay.classList.remove('show');
  });

</script>

</body>
</html>
